<header class="site-header">

  <div class="wrapper">
    {%- assign default_paths = site.pages | map: "path" -%}
    {%- assign page_paths = site.header_pages | default: default_paths -%}
    {%- assign titles_size = site.pages | map: 'title' | join: '' | size -%}
    <a class="site-title" rel="author" href="{{ "/" | relative_url }}"><img id="logo" class="rdwn-logo"></a>

    {%- if titles_size > 0 -%}
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          {%- for path in page_paths -%}
            {%- assign my_page = site.pages | where: "path", path | first -%}
            {%- if my_page.title -%}
            <a class="page-link" href="{{ my_page.url | relative_url }}">{{ my_page.title | escape }}</a>
            {%- endif -%}
          {%- endfor -%}
        </div>

        <a id="theme-toggle" onclick="modeSwitcher()"></a>
      </nav>

    {%- endif -%}
  </div>

  <script>

      // this checks whether system dark mode is set
  let systemInitiatedDark = window.matchMedia("(prefers-color-scheme: dark)");
  console.log(systemInitiatedDark);
  // this checks for session storage telling to override
  // the system preferences
  let theme = sessionStorage.getItem('theme');
  console.log(theme)

  if (systemInitiatedDark.matches) {
	document.getElementById("theme-toggle").innerHTML = "Light Mode";
} else {
	document.getElementById("theme-toggle").innerHTML = "Drrr Mode";
}

function prefersColorTest(systemInitiatedDark) {
  if (systemInitiatedDark.matches) {
    console.log('Im here');
  	document.body.setAttribute('data-theme', 'dark');
   	document.getElementById("theme-toggle").innerHTML = "Light Mode";
   	// this clears the session storage
   	sessionStorage.setItem('theme', '');
  } else {
    document.body.setAttribute('data-theme', 'light');
    console.log('Im here');
    document.getElementById("theme-toggle").innerHTML = "Dark Mode";
    sessionStorage.setItem('theme', '');
  }
}
systemInitiatedDark.addListener(prefersColorTest);

function modeSwitcher() {
// it's important to check for overrides again
	let theme = sessionStorage.getItem('theme');
	// checks if reader selected dark mode
	if (theme === "dark") {
		document.body.setAttribute('data-theme', 'light');
		sessionStorage.setItem('theme', 'light');
		document.getElementById("theme-toggle").innerHTML = "Dark Mode";
		// checks if reader selected light mode
	}	else if (theme === "light") {
		document.body.setAttribute('data-theme', 'dark');
		sessionStorage.setItem('theme', 'dark');
		document.getElementById("theme-toggle").innerHTML = "Light Mode";
		// checks if system set dark mode
	} else if (systemInitiatedDark.matches) {
		document.body.setAttribute('data-theme', 'light');
		sessionStorage.setItem('theme', 'light');
		document.getElementById("theme-toggle").innerHTML = "Dark Mode";
		// the only option left is system set light mode
	} else {
		document.body.setAttribute('data-theme', 'dark');
		sessionStorage.setItem('theme', 'dark');
		document.getElementById("theme-toggle").innerHTML = "Light Mode";
  }

  if (theme === "dark") {
	document.body.setAttribute('data-theme', 'dark');
	sessionStorage.setItem('theme', 'dark');
	document.getElementById("theme-toggle").innerHTML = "Light Mode";
} else if (theme === "light") {
	document.body.setAttribute('data-theme', 'light');
	sessionStorage.setItem('theme', 'light');
	document.getElementById("theme-toggle").innerHTML = "Dark Mode";
}





    // let toggle = document.getElementById('theme-toggle');
    // toggle.innerHTML = 'Dark Mode';


    // const theme = localStorage.getItem('theme');

    //   if (theme === "dark") {
    //     document.body.setAttribute('data-theme', 'dark');
    //   }

    //   const userPrefers = getComputedStyle(document.body).getPropertyValue('content');

    //   if (theme === "dark") {
    //     document.getElementById("theme-toggle").innerHTML = "Light Mode";
    //   } else if (theme === "light") {
    //     document.getElementById("theme-toggle").innerHTML = "Dark Mode";
    //   } else if  (userPrefers === "dark") {
    //     document.body.setAttribute('data-theme', 'dark');
    //     window.localStorage.setItem('theme', 'dark');
    //     document.getElementById("theme-toggle").innerHTML = "Light Mode";
    //   } else {
    //     document.body.setAttribute('data-theme', 'light');
    //     window.localStorage.setItem('theme', 'light');
    //     document.getElementById("theme-toggle").innerHTML = "Dark Mode";
    //   }

    //   function modeSwitcher() {
    //     let currentMode = document.body.getAttribute('data-theme');
    //     if (currentMode === "dark") {
    //       document.body.setAttribute('data-theme', 'light');
    //       window.localStorage.setItem('theme', 'light');
    //       document.getElementById("theme-toggle").innerHTML = "Dark Mode";
    //     } else {
    //       document.body.setAttribute('data-theme', 'dark');
    //       window.localStorage.setItem('theme', 'dark');
    //       document.getElementById("theme-toggle").innerHTML = "Light Mode";
    //     }
    //   }




    // function modeSwitcher(){
    // if(isDark == false){
    // toggle.innerHTML = 'Light Mode';
    // document.body.setAttribute('data-theme', 'dark');

    // } else {
    // document.body.removeAttribute('data-theme');
    // toggle.innerHTML = 'Dark Mode';

    // }

    // }

    // if (isDark==false){
    // toggle.innerHTML = 'Dark Mode';
    // document.getElementById.setAttribute('onclick', modeSwitcher())
    // }




    // let navLinks = document.getElementsByClassName('page-link');
    // document.getElementById('logo').setAttribute('data-theme', 'dark');
    // console.log(navLinks);

    // for(var i=0; i< navLinks.length; i++){

    //   navLinks[i].setAttribute('data-theme', 'dark');

    // }


    }




  </script>
</header>
